PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX p: <http://www.wikidata.org/prop/>
PREFIX ps: <http://www.wikidata.org/prop/statement/>
PREFIX pq: <http://www.wikidata.org/prop/qualifier/>
PREFIX wikibase: <http://wikiba.se/ontology#>

SELECT DISTINCT ?itemLabel ?population WHERE {
  ?item wdt:P31 wd:Q6256.  # ?item is a country
  MINUS { ?item wdt:P31 wd:Q15893266. }  # Exclude former entities
  
  ?item p:P1082 ?populationStatement.  # Get population statement
  ?populationStatement ps:P1082 ?population.  # Get population value
  OPTIONAL { ?populationStatement pq:P585 ?date. }  # Get point in time (P585) if available
  
  # Filter to get only the latest population value if date exists
  FILTER NOT EXISTS {
    ?item p:P1082 ?otherStatement.
    ?otherStatement ps:P1082 ?otherPopulation.
    OPTIONAL { ?otherStatement pq:P585 ?otherDate. }
    FILTER (?otherDate > ?date)
  }
  
  SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
ORDER BY ?itemLabel